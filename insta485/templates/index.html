<!DOCTYPE html>
<html lang="en">

<head>
    <link rel="stylesheet" href="./css/style.css">
    <title>insta485</title>
</head>

<body>
    <div class="header">
        <a href="/">Home</a>
        <div class="nav">
            <a href="/explore/">explore</a>
            <a href="/users/{{ logname }}/">{{ logname }}</a>
        </div> <!-- Closing div.nav -->
    </div> <!-- Closing div.header -->
    
    {% for post in posts %}
    <div class="image">
        <div class="imageheader">
            <a href="/users/{{post.owner}}/"><img alt="image" src="/uploads/{{post.owner_file}}"></a>
            <a href="/users/{{post.owner}}/">{{post.owner}}</a>
            <a href="/posts/{{post.postid}}/">{{post.created}}</a>
        </div> <!-- Closing div.imageheader -->
        
        <img alt="image" src="/uploads/{{post.post_file}}">
        
        <div class="imageFooter">
            {% set ns = namespace(c = 0) %}

            {% for like in likes %}
                {% if like.postid == post.postid %}
                    {% set ns.c = ns.c + 1 %}
                {% endif %}
            {% endfor %}

            <p>{{ ns.c }} like{{ "s" if ns.c != 1 else "" }}</p>
            
            {% for key in liked_post_dict %}
                {% if key == post.postid %}
                    {% if liked_post_dict[key] %}
                    <form action="/likes/" method="post" enctype="multipart/form-data">
                        <input type="hidden" name="operation" value="unlike" />
                        <input type="hidden" name="postid" value="{{ post.postid }}" />
                        <input type="submit" name="unlike" value="unlike" />
                    </form>
                    {% else %}
                    <form action="/likes/" method="post" enctype="multipart/form-data">
                        <input type="hidden" name="operation" value="like" />
                        <input type="hidden" name="postid" value="{{ post.postid }}" />
                        <input type="submit" name="like" value="like" />
                    </form>
                    {% endif %}
                {% endif %}
            {% endfor %}

            <form action="/comments/" method="post" enctype="multipart/form-data">
                <input type="hidden" name="operation" value="create" />
                <input type="hidden" name="postid" value="{{post.postid}}" />
                <input type="text" name="text" required />
                <input type="submit" name="comment" value="comment" />
            </form>
            
            {% for comment in comments %}
                {% if comment.postid == post.postid %}
                <div>
                    <a href="/users/{{ comment.owner }}/">{{comment.owner}}</a>
                    <span>{{comment.text}}</span>
                </div>
                {% endif %}
            {% endfor %}
        </div> <!-- Closing div.imageFooter -->
    </div> <!-- Closing div.image -->
    {% endfor %}
    
</body> <!-- Closing body -->
</html>
